var we=Object.defineProperty,ve=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var te=(t,n,r)=>n in t?we(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,A=(t,n)=>{for(var r in n||(n={}))Ce.call(n,r)&&te(t,r,n[r]);if(ie)for(var r of ie(n))_e.call(n,r)&&te(t,r,n[r]);return t},Y=(t,n)=>ve(t,xe(n));var v=(t,n,r)=>(te(t,typeof n!="symbol"?n+"":n,r),r);import{u as Se,a as Pe,c as ce,b as ke,r as c,j as o,T as Ie,d as e,C as Te,A as Ee,e as se,f as Oe,g as m,L as W,B as ne,I as de,h as Ae,M as Le,i as le,k as D,p as S,l as Ne,m as Re,n as De,P as L,S as P,o as z,q as _,s as F,t as je,D as Ge,v as Fe,F as J,w as V,x as H,G,y as $,z as X,E as Q,H as re,J as ee,K as Ue,N as Be,O as Me,Q as qe,R as We,U as ze,V as Ke,W as Ye,X as He,Y as Je,Z as Ze,_ as Ve,$ as $e,a0 as q}from"./vendor.06528c08.js";const Xe=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}};Xe();const M=()=>Se(),B=Pe,Qe={authed:!!localStorage.getItem("TOKEN")},ue=ce({name:"user",initialState:Qe,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:et,logout:oe}=ue.actions;var tt=ue.reducer;const nt=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,rt=ke({palette:{mode:nt?"dark":"light"}});function ot(t){const n=M(),r=B(g=>g.user.authed),[a,i]=c.exports.useState(null),s=g=>{i(g.currentTarget)},l=()=>{i(null)},u=()=>{i(null),n(S("/")),n(oe()),localStorage.removeItem("TOKEN")};return o(Ie,{theme:rt,children:[e(Te,{}),e(Ee,{position:"absolute",color:"default",elevation:0,sx:{position:"relative",borderBottom:g=>`1px solid ${g.palette.divider}`},children:e(se,{maxWidth:"xl",children:o(Oe,{disableGutters:!0,children:[e(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,mr:2,display:{xs:"none",md:"flex"}},children:e(W,{color:"inherit",underline:"none",href:"/",children:"Furcation Registration"})}),o(ne,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[e(de,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:s,color:"inherit",children:e(Ae,{})}),o(Le,{id:"menu-appbar",anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(a),onClose:l,sx:{display:{xs:"block",md:"none"}},children:[r?e(le,{onClick:u,children:e(m,{textAlign:"center",children:"Logout"})}):null,e(le,{onClick:l,children:e("a",{href:"//furcation.org.uk",children:e(m,{textAlign:"center",children:"Return to main site"})})})]})]}),e(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:"Furcation Registration"}),o(ne,{sx:{display:{xs:"none",md:"flex"}},children:[r?e(D,{onClick:u,sx:{my:2,display:"block"},children:"Logout"}):null,e(D,{onClick:l,sx:{my:2,display:"block"},href:"//furcation.org.uk",children:"Return to main site"})]})]})})}),e(se,{component:"main",children:t.children})]})}const at={config:{}},he=ce({name:"config",initialState:at,reducers:{setConfig(t,n){t.config=n.payload}}}),{setConfig:it}=he.actions;var st=he.reducer;const{createReduxHistory:lt,routerMiddleware:ct,routerReducer:dt}=Ne({history:Re()}),ae=De({reducer:{router:dt,user:tt,config:st},middleware:[ct]}),ut=lt(ae);function ht(){const t=M(),n=B(a=>a.config.config.INTRO_TEXT||""),r=B(a=>a.user.authed);return c.exports.useEffect(()=>{r&&t(S("/manage"))},[]),o(L,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(m,{variant:"h6",color:"inherit",children:"Welcome to Furcation 2022 Registation"}),n.split(`
`).map((a,i)=>e(m,{variant:"body1",color:"inherit",paragraph:!0,children:a},i)),o(P,{spacing:2,alignItems:"center",children:[e(D,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(S("/newregistration")),children:"Register for Furcation"}),e(D,{variant:"outlined",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(S("/login")),children:"Already registered? Log in"})]})]})}const E=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/";function mt(t,n){return fetch(E+"auth/users/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y(A({},t),{recaptcha_token:n}))})}function gt(t,n){return fetch(E+"auth/token/login/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t,password:n})})}function pt(t){return fetch(E+"auth/users/reset_password/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t})})}function ft(t,n,r){return fetch(E+"auth/users/reset_password_confirm/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({new_password:t,uid:n,token:r})})}function bt(){return fetch(E+"auth/users/me/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function yt(t){return fetch(E+"auth/users/me/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function wt(){return fetch(E+"group/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function vt(){return fetch(E+"group/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function xt(){return fetch(E+"group/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ct(t){return fetch(E+"group/",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({id:t})})}function _t(){return fetch(E+"badge-image/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function St(t,n){return fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:n})}function Pt(){return fetch(E+"badge-image/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function kt(){return fetch(E+"config/",{method:"GET"})}function It(t,n){return fetch(E+"auth/users/activation/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:t,token:n})})}function Tt(){const t=M(),[n,r]=c.exports.useState(""),[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState(""),[b,y]=c.exports.useState(""),x=B(d=>d.user.authed);return c.exports.useEffect(()=>{x&&t(S("/manage"));const d=new URLSearchParams(window.location.search),p=d.get("uid"),w=d.get("token");!x&&p&&w&&It(p,w).then(f=>{f.status==204||f.status==403?y("Email verified!  You can now login below."):(g("Error while validating email."),f.json().then(j=>console.log(j)))})},[]),o(P,{component:"form",onSubmit:d=>{d.preventDefault(),l(!0),gt(n,a).then(p=>{p.status==200?p.json().then(w=>{localStorage.setItem("TOKEN",w.auth_token),t(et()),t(S("/manage"))}):p.json().then(w=>{console.log(w),g(w.non_field_errors),l(!1)})})},spacing:2,sx:{my:{xs:3,md:3}},children:[u?e(z,{severity:"error",children:u}):null,b?e(z,{severity:"success",children:b}):null,e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Sign in"}),e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:s,type:"email",autoComplete:"email",name:"email",value:n,onChange:d=>{r(d.target.value)},label:"Email Address"}),e(_,{required:!0,fullWidth:!0,disabled:s,type:"password",name:"password",onChange:d=>{i(d.target.value)},value:a,label:"Password"}),e(F,{loading:s,loadingPosition:"center",type:"submit",variant:"contained",children:"Login"}),e(D,{variant:"outlined",onClick:()=>{t(S("/recover"))},children:"Forgot password?"})]})})]})}function me(t){const n=r=>{t.emergencyContact[r.target.name]=r.target.value,t.onChange(t.emergencyContact)};return o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Emergency Contacts"}),e(m,{variant:"body1",color:"inherit",children:"Please provide a contact we can call in case of emergency"}),e(_,{required:!0,disabled:t.disabled,name:"ice_name",label:"Emergency Contact Name",value:t.emergencyContact.ice_name,onChange:n,autoComplete:"phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_name"),helperText:t.errors.ice_name}),e(_,{required:!0,disabled:t.disabled,type:"tel",name:"ice_phone",label:"Emergency Phone Number",value:t.emergencyContact.ice_phone,onChange:n,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_phone"),helperText:t.errors.ice_phone})]})}class ge{constructor(){v(this,"email","");v(this,"full_name","");v(this,"nickname","");v(this,"date_of_birth","1990-01-01");v(this,"address","");v(this,"phone_number","");v(this,"medical_details","");v(this,"ice_name","");v(this,"ice_phone","");v(this,"is_sponsor",!1);v(this,"is_early",!1);v(this,"is_late",!1);v(this,"is_fursuiter",!1)}}class Et extends ge{constructor(){super(...arguments);v(this,"confirm_email","");v(this,"password","");v(this,"confirm_password","")}}class Ot extends ge{constructor(){super(...arguments);v(this,"id",0);v(this,"badge_override","");v(this,"badge_image","")}}function pe(t){const[n,r]=c.exports.useState(t.userInfo.date_of_birth),a=l=>{const u=new Date(l),g=u.getFullYear()+"-"+("0"+(u.getMonth()+1)).slice(-2)+"-"+("0"+u.getDate()).slice(-2);r(g),t.userInfo.date_of_birth=g,t.onChange(t.userInfo)},i=l=>{t.userInfo[l.target.name]=l.target.value,t.onChange(t.userInfo)},s=l=>{t.userInfo[l.target.name]=l.target.checked,t.onChange(t.userInfo)};return o(P,{spacing:2,children:[e(_,{required:!0,disabled:t.disabled,name:"full_name",label:"Full (Legal) Name",value:t.userInfo.full_name,onChange:i,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(t.errors,"full_name"),helperText:t.errors.full_name}),e(_,{required:!0,disabled:t.disabled,name:"nickname",label:"Furry Name (Nickname/Badge Name)",value:t.userInfo.nickname,onChange:i,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(t.errors,"nickname"),helperText:t.errors.nickname}),e(je,{dateAdapter:Ge,children:e(Fe,{label:"Date of Birth (yyyy-mm-dd)",disabled:t.disabled,value:n,onChange:a,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:l=>e(_,Y(A({name:"date_of_birth"},l),{required:!0,error:Object.prototype.hasOwnProperty.call(t.errors,"date_of_birth"),helperText:t.errors.date_of_birth}))})}),e(_,{required:!0,multiline:!0,disabled:t.disabled,rows:4,name:"address",label:"Address",value:t.userInfo.address,onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"address"),helperText:t.errors.address}),e(_,{required:!0,disabled:t.disabled,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:t.userInfo.phone_number,onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"phone_number"),helperText:t.errors.phone_number}),e(_,{multiline:!0,disabled:t.disabled,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:t.userInfo.medical_details||"",onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"medical_details"),helperText:t.errors.medical_details}),t.isSignup?null:o(J,{children:[e(m,{variant:"h6",color:"inherit",children:"Fursuiting"}),e(m,{variant:"body1",color:"inherit",children:"You don't need a fursuit to attend Furcation, but to help us plan for fursuiting events, please let us know if you're bringing your fursuit."}),e(V,{control:e(H,{name:"is_fursuiter",checked:t.userInfo.is_fursuiter,onChange:s}),label:"I'm bringing my fursuit"}),e(m,{variant:"h6",color:"inherit",children:"Early/Late Arrival"}),o(m,{variant:"body1",color:"inherit",children:["You can see how early/late arrival will affect your ticket price on the pricing page of our website"," ",e(W,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),e(V,{control:e(H,{name:"is_early",checked:t.userInfo.is_early,onChange:s}),label:"I want to arrive a day early (Arrive on the afternoon of the 10th November)"}),e(V,{control:e(H,{name:"is_late",checked:t.userInfo.is_late,onChange:s}),label:"I want to leave a day late (Leave on the morning of the 15th November)"}),e(m,{variant:"h6",color:"inherit",children:"Sponsor"}),o(m,{variant:"body1",color:"inherit",children:["You can choose to help support the convention further by becoming one of our sponsors. Sponsoring costs \xA340 and sponsors get a goodybag on arrival. You can read more about sponsoring on our pricing page"," ",e(W,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),e(V,{control:e(H,{name:"is_sponsor",checked:t.userInfo.is_sponsor,onChange:s}),label:"I want to sponsor"})]})]})}function At(){return o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Legal"}),o(m,{variant:"body1",color:"inherit",children:[e(H,{required:!0,name:"t_and_cs"}),"Do you agree to the"," ",e(W,{href:"https://www.furcation.org.uk/docs/privacypolicy.pdf",target:"_blank",children:"privacy policy"})," ","and the"," ",e(W,{href:"https://www.furcation.org.uk/docs/codeofconduct.pdf",target:"_blank",children:"code of conduct"}),"?"]})]})}function Lt(){const t=M(),[n,r]=c.exports.useState(new Et),[a,i]=c.exports.useState(!1),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState({}),[b,y]=c.exports.useState(""),x=B(f=>f.user.authed);c.exports.useEffect(()=>{x&&t(S("/manage"))},[]);const O=f=>{r(Y(A({},n),{[f.target.name]:f.target.value}))},N=f=>{r(A(A({},n),f))},h=f=>{r(A(A({},n),f))},I=()=>{t(S("/login"))},d=f=>{const j=Date.parse("11 November 2004");if(f.preventDefault(),i(!0),n.email!==n.confirm_email){p({email:"Email and confirm email did not match."});return}if(n.password!==n.confirm_password){p({password:"Password and confirm password did not match."});return}if(Date.parse(n.date_of_birth)>=j){p({date_of_birth:"You must be 18 years old by November 11th 2022."});return}n.phone_number=w(n.phone_number),n.ice_phone=w(n.ice_phone),console.log(n),window.grecaptcha.enterprise.ready(function(){window.grecaptcha.enterprise.execute("6LeVPFEhAAAAAGC1Sc6mImon0DWwloJD3c_nyRU2",{action:"register"}).then(function(Z){console.log("ReCAPTCHA token: "+Z),mt(n,Z).then(K=>{K.status==201?K.json().then(C=>{y(C.email),l(!0)}):K.json().then(C=>{p(C)})})})})},p=f=>{g(f),i(!1),window.scrollTo(0,0)},w=f=>(f=f.replaceAll(" ",""),f.charAt(0)==="0"?"+44"+f.substring(1):f);return o(P,{component:"form",onSubmit:d,spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(u).length>0?e(z,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,o(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:[e(m,{variant:"h6",color:"inherit",children:"New Registration"}),o(G,{container:!0,spacing:2,sx:{mt:2},children:[e(G,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:a,type:"email",autoComplete:"email",name:"email",value:n.email,onChange:O,label:"Email Address",error:Object.prototype.hasOwnProperty.call(u,"email"),helperText:u.email})}),e(G,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"email",name:"confirm_email",onChange:O,value:n.confirm_email,label:"Confirm Email",error:Object.prototype.hasOwnProperty.call(u,"confirm_email"),helperText:u.confirm_email})}),e(G,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"password",name:"password",onChange:O,value:n.password,label:"Password",error:Object.prototype.hasOwnProperty.call(u,"password"),helperText:u.password})}),e(G,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"password",name:"confirm_password",onChange:O,value:n.confirm_password,label:"Confirm Password",error:Object.prototype.hasOwnProperty.call(u,"confirm_password"),helperText:u.confirm_password})})]})]}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(pe,{userInfo:n,onChange:h,disabled:a,errors:u,isSignup:!0})}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(me,{emergencyContact:n,onChange:N,disabled:a,errors:u})}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(At,{})}),e(F,{loading:a,loadingPosition:"center",type:"submit",variant:"contained",children:"Next"}),o($,{open:s,onClose:I,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(X,{id:"alert-dialog-title",children:"You're almost done!"}),e(Q,{children:o(re,{id:"alert-dialog-description",children:["An email has been sent to ",b,". Please click the link in there to verify your account."]})}),e(ee,{children:e(D,{onClick:I,autoFocus:!0,children:"Log In"})})]})]})}function Nt(t){const n=M(),[r,a]=c.exports.useState(null),[i,s]=c.exports.useState(""),[l,u]=c.exports.useState(""),[g,b]=c.exports.useState(!1);c.exports.useEffect(()=>{y()},[]);const y=()=>{wt().then(d=>{b(!1),d.status==200?d.json().then(p=>{a(p)}):d.status==404?a(null):d.status==401&&(n(S("/")),n(oe()),localStorage.removeItem("TOKEN"))})},x=d=>{s(d.target.value.trim())},O=d=>{d.preventDefault(),b(!0),Ct(i).then(p=>{p.status==200?(u(""),y()):(b(!1),p.json().then(w=>u(w.details)))})},N=()=>{b(!0),vt().then(d=>{d.status==201?(u(""),y()):(b(!1),d.json().then(p=>u(p.details)))})},h=()=>{r&&navigator.clipboard.writeText(r.id)},I=()=>{b(!0),xt().then(d=>{d.status==200?(u(""),y()):(b(!1),d.json().then(p=>u(p.details)))})};return o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Accommodation Group"}),o(m,{variant:"body1",color:"inherit",children:["Furcation has a variety of units available to suit various budgets and group sizes. You can read more about accommodation pricing and the features of each type of unit"," ",e(W,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),". During pre-reg you cannot select an accommodation, but you can choose who you wish to group with."]}),l?e(z,{severity:"error",children:l}):null,r?o(J,{children:[o(m,{variant:"body1",color:"inherit",children:[r.owner.nickname,"'s group",e(D,{onClick:I,sx:{ml:2},type:"submit",disabled:g,variant:"contained",color:"error",children:t.user.id==r.owner.id?"Disband Group":"Leave Group"})]}),o(m,{variant:"body1",color:"inherit",children:["Group code: ",r.id,e(Ue,{title:"Copy",children:e(de,{"aria-label":"copy",onClick:h,children:e(Be,{})})})]}),e(Me,{dense:!0,children:r.users.map((d,p)=>e(qe,{children:e(We,{primary:d.id==r.owner.id?d.nickname+" (host)":d.nickname})},p))})]}):o(J,{children:[e(m,{variant:"body1",color:"inherit",children:"Create a new group, or join someone else's group by entering their group code!"}),o(G,{component:"form",onSubmit:O,container:!0,spacing:2,sx:{mt:2,pr:2},children:[e(G,{item:!0,sm:12,md:5,children:e(_,{size:"small",disabled:g,fullWidth:!0,required:!0,id:"outlined-basic",label:"Group Code",variant:"outlined",value:i,onChange:x})}),e(G,{item:!0,sm:12,md:3,alignItems:"stretch",style:{display:"flex"},children:e(D,{fullWidth:!0,type:"submit",disabled:g,variant:"contained",children:"Join Group"})}),e(G,{item:!0,sm:12,md:4,alignItems:"stretch",style:{display:"flex"},children:e(D,{fullWidth:!0,variant:"outlined",disabled:g,onClick:N,children:"Create New Group"})})]})]})]})}const Rt=ze("input")({display:"none"});function Dt(t){const[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState({x:0,y:0}),[b,y]=c.exports.useState(1),[x,O]=c.exports.useState({width:100,height:100,x:0,y:0}),[N,h]=c.exports.useState(500);c.exports.useEffect(()=>{h(Math.min(500,window.screen.width-64))},[]);const I=async C=>{if(C.target.files&&C.target.files.length>0){l(!0);const k=C.target.files[0];d(k).then(T=>{g({x:0,y:0}),y(1),l(!1),i(T)})}},d=C=>new Promise(k=>{const T=new FileReader;T.addEventListener("load",()=>k(T.result),!1),T.readAsDataURL(C)}),p=()=>{i("")},w=(C,k)=>{O(k)},f=()=>{l(!0),j(a,x).then(C=>{_t().then(k=>{k.status==201&&k.json().then(T=>{St(T.upload_url,C).then(()=>{t.badgeImageChanged(T.badge_image),l(!1),p()})})})})},j=async(C,k)=>{const T=await Z(C),R=document.createElement("canvas"),U=R.getContext("2d");if(!U)return null;R.width=T.width,R.height=T.height,U.imageSmoothingEnabled=!0,U.scale(300/k.width,300/k.height),U.drawImage(T,-k.x,-k.y);const fe=U.getImageData(0,0,300,300);return R.width=300,R.height=300,U.putImageData(fe,0,0),new Promise(be=>{R.toBlob(ye=>{be(ye)},"image/jpeg")})},Z=C=>new Promise((k,T)=>{const R=new Image;R.addEventListener("load",()=>k(R)),R.addEventListener("error",U=>T(U)),R.src=C}),K=()=>{l(!0),Pt().then(C=>{C.status==200&&(l(!1),t.badgeImageChanged(""))})};return o(J,{children:[o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Badge Image"}),t.user.badge_image?o(P,{direction:"row",children:[e("img",{style:{width:"150px",marginRight:"8px"},src:"https://storage.googleapis.com/reggie-badges/"+t.user.badge_image}),e(ne,{alignItems:"center",display:"flex",justifyContent:"center",children:e(F,{loading:s,loadingPosition:"center",variant:"contained",color:"error",onClick:K,children:"Delete Badge Image"})})]}):o("label",{htmlFor:"contained-button-file",children:[e(Rt,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:I}),e(F,{loading:s,loadingPosition:"center",variant:"contained",component:"span",children:"Upload Badge Image"})]})]}),o($,{open:!!a,onClose:p,children:[o(X,{children:["Crop Badge Image",e(m,{children:"Scroll or pinch to zoom. Click and drag to move."})]}),e(Q,{style:{position:"relative",width:N+"px",height:N+"px"},children:e(Ke,{image:a,crop:u,zoom:b,aspect:1,onCropChange:g,onZoomChange:y,onCropComplete:w})}),e(ee,{children:e(F,{loading:s,loadingPosition:"center",onClick:f,autoFocus:!0,children:"Upload"})})]})]})}function jt(){const t=M(),[n,r]=c.exports.useState(null),[a,i]=c.exports.useState({}),[s,l]=c.exports.useState(0),u=B(h=>h.user.authed);c.exports.useEffect(()=>{if(!u){t(S("/"));return}bt().then(h=>{h.status==200?h.json().then(I=>{r(Object.assign(new Ot,I))}):h.status==401&&(t(S("/")),t(oe()),localStorage.removeItem("TOKEN"))})},[]);const g=h=>{h.preventDefault(),l(1),n&&(n.phone_number=y(n.phone_number),n.ice_phone=y(n.ice_phone),yt(n).then(I=>{I.status==200?l(2):I.json().then(d=>{b(d),console.log(d)})}))},b=h=>{i(h),l(0),window.scrollTo(0,0)},y=h=>(h=h.replaceAll(" ",""),h.charAt(0)==="0"?"+44"+h.substring(1):h),x=h=>{n&&(l(0),r(A(A({},n),h)))},O=h=>{n&&(l(0),r(A(A({},n),h)))},N=h=>{n&&r(Y(A({},n),{badge_image:h}))};return o(P,{spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(a).length>0?e(z,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,n?o(J,{children:[o(P,{component:"form",onSubmit:g,spacing:2,children:[e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Your Attendee Infomation"}),o(m,{variant:"body1",color:"inherit",children:["Email: ",n.email]}),o(m,{variant:"body1",color:"inherit",children:["Badge Number:"," ",n.badge_override?n.badge_override:n.id]})]})}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(pe,{userInfo:n,onChange:O,disabled:s==1,errors:a,isSignup:!1})}),e(F,{loading:s==1,loadingPosition:"center",type:"submit",variant:"contained",color:s==2?"success":"primary",children:s==2?"Saved!":"Save Changes"}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(me,{emergencyContact:n,onChange:x,disabled:s==1,errors:a})}),e(F,{loading:s==1,loadingPosition:"center",type:"submit",variant:"contained",color:s==2?"success":"primary",children:s==2?"Saved!":"Save Changes"})]}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Nt,{user:n})}),e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Dt,{user:n,badgeImageChanged:N})})]}):null]})}function Gt(){const t=M(),{uid:n,token:r}=Ye(),[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(""),[u,g]=c.exports.useState(""),[b,y]=c.exports.useState(!1),[x,O]=c.exports.useState(!1),N=B(w=>w.user.authed);c.exports.useEffect(()=>{N&&t(S("/manage")),(!n||!r)&&t(S("/"))},[]);const h=w=>{if(w.preventDefault(),y(!0),!n||!r){g("Invalid token"),y(!1);return}if(a!=s){g("Passwords do not match"),y(!1);return}ft(a,n,r).then(f=>{f.status==204?O(!0):f.json().then(j=>{console.log(j),g(j.token||j.new_password),y(!1)})})},I=w=>{i(w.target.value)},d=w=>{l(w.target.value)},p=()=>{t(S("/login"))};return o(P,{component:"form",onSubmit:h,spacing:2,sx:{my:{xs:3,md:3}},children:[u?e(z,{severity:"error",children:u}):null,e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"New Password"}),e(_,{required:!0,fullWidth:!0,disabled:b,type:"password",name:"password",onChange:I,value:a,label:"Password"}),e(_,{required:!0,fullWidth:!0,disabled:b,type:"password",name:"confirm_password",onChange:d,value:s,label:"Confirm Password"})]})}),e(F,{loading:b,loadingPosition:"center",type:"submit",variant:"contained",children:"Change Password"}),o($,{open:x,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(X,{id:"alert-dialog-title",children:"Password Changed"}),e(Q,{children:e(re,{id:"alert-dialog-description",children:"Your password has been changed! You can now log in."})}),e(ee,{children:e(D,{onClick:p,autoFocus:!0,children:"Log In"})})]})]})}function Ft(){const t=M(),[n,r]=c.exports.useState(""),[a,i]=c.exports.useState(!1),[s,l]=c.exports.useState(!1),u=B(x=>x.user.authed);c.exports.useEffect(()=>{u&&t(S("/manage"))},[]);const g=x=>{x.preventDefault(),i(!0),pt(n).then(()=>{i(!1),l(!0)})},b=x=>{r(x.target.value)},y=()=>{t(S("/login"))};return o(P,{component:"form",onSubmit:g,spacing:2,sx:{my:{xs:3,md:3}},children:[e(L,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(P,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Forgot Password"}),e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:a,type:"email",autoComplete:"email",name:"email",value:n,onChange:b,label:"Email Address"})]})}),e(F,{loading:a,loadingPosition:"center",type:"submit",variant:"contained",children:"Send recovery email"}),o($,{open:s,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(X,{id:"alert-dialog-title",children:"Email sent"}),e(Q,{children:o(re,{id:"alert-dialog-description",children:["If an account exists for ",n,", then an email has been sent."]})}),e(ee,{children:e(D,{onClick:y,autoFocus:!0,children:"Log In"})})]})]})}He.render(e(Je.StrictMode,{children:e(Ze,{store:ae,children:e(ot,{children:e(Ve,{history:ut,children:o($e,{children:[e(q,{path:"/",element:e(ht,{})}),e(q,{path:"/login",element:e(Tt,{})}),e(q,{path:"/recover",element:e(Ft,{})}),e(q,{path:"/recover/confirm/:uid/:token",element:e(Gt,{})}),e(q,{path:"/newregistration",element:e(Lt,{})}),e(q,{path:"/manage",element:e(jt,{})})]})})})})}),document.getElementById("root"));kt().then(t=>{t.status==200&&t.json().then(n=>{const r={};n.results.map(a=>{r[a.id]=a.value}),ae.dispatch(it(r))})});
