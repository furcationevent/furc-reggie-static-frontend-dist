var xe=Object.defineProperty,Ce=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var re=(t,n,r)=>n in t?xe(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,O=(t,n)=>{for(var r in n||(n={}))Se.call(n,r)&&re(t,r,n[r]);if(le)for(var r of le(n))Ie.call(n,r)&&re(t,r,n[r]);return t},J=(t,n)=>Ce(t,_e(n));var v=(t,n,r)=>(re(t,typeof n!="symbol"?n+"":n,r),r);import{u as Pe,a as Ee,c as ue,b as Te,r as c,j as o,T as ke,d as e,C as Oe,A as Ae,e as ce,f as De,g as m,L as M,B as oe,I as he,h as Le,M as Ne,i as de,k as N,p as S,l as Ge,m as Re,n as je,P as A,S as I,o as q,q as _,s as j,t as Be,D as Fe,v as Ue,F as V,w as X,x as Z,G as R,y as Q,z as ee,E as te,H as ae,J as ne,K as He,N as We,O as Me,Q as qe,R as ze,U as Ke,V as Ye,W as Je,X as Ze,Y as Ve,Z as $e,_ as Xe,$ as Qe,a0 as W}from"./vendor.06528c08.js";const et=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}};et();const F=()=>Pe(),B=Ee,tt={authed:!!localStorage.getItem("TOKEN")},me=ue({name:"user",initialState:tt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:nt,logout:ie}=me.actions;var rt=me.reducer;const ot=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,at=Te({palette:{mode:ot?"dark":"light"}});function it(t){const n=F(),r=B(g=>g.user.authed),[a,i]=c.exports.useState(null),s=g=>{i(g.currentTarget)},l=()=>{i(null)},u=()=>{i(null),n(S("/")),n(ie()),localStorage.removeItem("TOKEN")};return o(ke,{theme:at,children:[e(Oe,{}),e(Ae,{position:"absolute",color:"default",elevation:0,sx:{position:"relative",borderBottom:g=>`1px solid ${g.palette.divider}`},children:e(ce,{maxWidth:"xl",children:o(De,{disableGutters:!0,children:[e(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,mr:2,display:{xs:"none",md:"flex"}},children:e(M,{color:"inherit",underline:"none",href:"/",children:"Furcation Registration"})}),o(oe,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[e(he,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:s,color:"inherit",children:e(Le,{})}),o(Ne,{id:"menu-appbar",anchorEl:a,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(a),onClose:l,sx:{display:{xs:"block",md:"none"}},children:[r?e(de,{onClick:u,children:e(m,{textAlign:"center",children:"Logout"})}):null,e(de,{onClick:l,children:e("a",{href:"//furcation.org.uk",children:e(m,{textAlign:"center",children:"Return to main site"})})})]})]}),e(m,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:"Furcation Registration"}),o(oe,{sx:{display:{xs:"none",md:"flex"}},children:[r?e(N,{onClick:u,sx:{my:2,display:"block"},children:"Logout"}):null,e(N,{onClick:l,sx:{my:2,display:"block"},href:"//furcation.org.uk",children:"Return to main site"})]})]})})}),e(ce,{component:"main",children:t.children})]})}const st={config:{}},ge=ue({name:"config",initialState:st,reducers:{setConfig(t,n){t.config=n.payload}}}),{setConfig:lt}=ge.actions;var ct=ge.reducer;const{createReduxHistory:dt,routerMiddleware:ut,routerReducer:ht}=Ge({history:Re()}),se=je({reducer:{router:ht,user:rt,config:ct},middleware:[ut]}),mt=dt(se);function gt(){const t=F(),n=B(a=>a.config.config.INTRO_TEXT||""),r=B(a=>a.user.authed);return c.exports.useEffect(()=>{r&&t(S("/manage"))},[]),o(A,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(m,{variant:"h6",color:"inherit",children:"Welcome to Furcation 2022 Registation"}),n.split(`
`).map((a,i)=>e(m,{variant:"body1",color:"inherit",paragraph:!0,children:a},i)),o(I,{spacing:2,alignItems:"center",children:[e(N,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(S("/newregistration")),children:"Register for Furcation"}),e(N,{variant:"outlined",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(S("/login")),children:"Already registered? Log in"})]})]})}const T=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/";function pt(t,n){return fetch(T+"auth/users/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(J(O({},t),{recaptcha_token:n}))})}function ft(t,n){return fetch(T+"auth/token/login/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t,password:n})})}function bt(t){return fetch(T+"auth/users/reset_password/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t})})}function yt(t,n,r){return fetch(T+"auth/users/reset_password_confirm/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({new_password:t,uid:n,token:r})})}function wt(){return fetch(T+"auth/users/me/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function vt(t){return fetch(T+"auth/users/me/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function xt(){return fetch(T+"group/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ct(){return fetch(T+"group/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function _t(){return fetch(T+"group/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function St(t){return fetch(T+"group/",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({id:t})})}function It(){return fetch(T+"badge-image/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Pt(t,n){return fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:n})}function Et(){return fetch(T+"badge-image/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Tt(){return fetch(T+"config/",{method:"GET"})}function kt(t,n){return fetch(T+"auth/users/activation/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:t,token:n})})}function Ot(){const t=F(),[n,r]=c.exports.useState(""),[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState(""),[b,y]=c.exports.useState(""),x=B(d=>d.user.authed);return c.exports.useEffect(()=>{x&&t(S("/manage"));const d=new URLSearchParams(window.location.search),p=d.get("uid"),w=d.get("token");!x&&p&&w&&kt(p,w).then(f=>{f.status==204||f.status==403?y("Email verified!  You can now login below."):(g("Error while validating email."),f.json().then(G=>console.log(G)))})},[]),o(I,{component:"form",onSubmit:d=>{d.preventDefault(),l(!0),ft(n,a).then(p=>{p.status==200?p.json().then(w=>{localStorage.setItem("TOKEN",w.auth_token),t(nt()),t(S("/manage"))}):p.json().then(w=>{console.log(w),g(w.non_field_errors),l(!1)})})},spacing:2,sx:{my:{xs:3,md:3}},children:[u?e(q,{severity:"error",children:u}):null,b?e(q,{severity:"success",children:b}):null,e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Sign in"}),e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:s,type:"email",autoComplete:"email",name:"email",value:n,onChange:d=>{r(d.target.value)},label:"Email Address"}),e(_,{required:!0,fullWidth:!0,disabled:s,type:"password",name:"password",onChange:d=>{i(d.target.value)},value:a,label:"Password"}),e(j,{loading:s,loadingPosition:"center",type:"submit",variant:"contained",children:"Login"}),e(N,{variant:"outlined",onClick:()=>{t(S("/recover"))},children:"Forgot password?"})]})})]})}function pe(t){const n=r=>{t.emergencyContact[r.target.name]=r.target.value,t.onChange(t.emergencyContact)};return o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Emergency Contacts"}),e(m,{variant:"body1",color:"inherit",children:"Please provide a contact we can call in case of emergency"}),e(_,{required:!0,disabled:t.disabled,name:"ice_name",label:"Emergency Contact Name",value:t.emergencyContact.ice_name,onChange:n,autoComplete:"phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_name"),helperText:t.errors.ice_name}),e(_,{required:!0,disabled:t.disabled,type:"tel",name:"ice_phone",label:"Emergency Phone Number",value:t.emergencyContact.ice_phone,onChange:n,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_phone"),helperText:t.errors.ice_phone})]})}class fe{constructor(){v(this,"email","");v(this,"full_name","");v(this,"nickname","");v(this,"date_of_birth","1990-01-01");v(this,"address","");v(this,"phone_number","");v(this,"medical_details","");v(this,"ice_name","");v(this,"ice_phone","");v(this,"is_sponsor",!1);v(this,"is_early",!1);v(this,"is_late",!1);v(this,"is_fursuiter",!1)}}class At extends fe{constructor(){super(...arguments);v(this,"confirm_email","");v(this,"password","");v(this,"confirm_password","")}}class Dt extends fe{constructor(){super(...arguments);v(this,"id",0);v(this,"badge_override","");v(this,"badge_image","")}}function be(t){const[n,r]=c.exports.useState(t.userInfo.date_of_birth),a=l=>{const u=new Date(l),g=u.getFullYear()+"-"+("0"+(u.getMonth()+1)).slice(-2)+"-"+("0"+u.getDate()).slice(-2);r(g),t.userInfo.date_of_birth=g,t.onChange(t.userInfo)},i=l=>{t.userInfo[l.target.name]=l.target.value,t.onChange(t.userInfo)},s=l=>{t.userInfo[l.target.name]=l.target.checked,t.onChange(t.userInfo)};return o(I,{spacing:2,children:[e(_,{required:!0,disabled:t.disabled,name:"full_name",label:"Full (Legal) Name",value:t.userInfo.full_name,onChange:i,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(t.errors,"full_name"),helperText:t.errors.full_name}),e(_,{required:!0,disabled:t.disabled,name:"nickname",label:"Furry Name (Nickname/Badge Name)",value:t.userInfo.nickname,onChange:i,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(t.errors,"nickname"),helperText:t.errors.nickname}),e(Be,{dateAdapter:Fe,children:e(Ue,{label:"Date of Birth (yyyy-mm-dd)",disabled:t.disabled,value:n,onChange:a,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:l=>e(_,J(O({name:"date_of_birth"},l),{required:!0,error:Object.prototype.hasOwnProperty.call(t.errors,"date_of_birth"),helperText:t.errors.date_of_birth}))})}),e(_,{required:!0,multiline:!0,disabled:t.disabled,rows:4,name:"address",label:"Address",value:t.userInfo.address,onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"address"),helperText:t.errors.address}),e(_,{required:!0,disabled:t.disabled,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:t.userInfo.phone_number,onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"phone_number"),helperText:t.errors.phone_number}),e(_,{multiline:!0,disabled:t.disabled,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:t.userInfo.medical_details||"",onChange:i,error:Object.prototype.hasOwnProperty.call(t.errors,"medical_details"),helperText:t.errors.medical_details}),t.isSignup?null:o(V,{children:[e(m,{variant:"h6",color:"inherit",children:"Fursuiting"}),e(m,{variant:"body1",color:"inherit",children:"You don't need a fursuit to attend Furcation, but to help us plan for fursuiting events, please let us know if you're bringing your fursuit."}),e(X,{control:e(Z,{name:"is_fursuiter",checked:t.userInfo.is_fursuiter,onChange:s}),label:"I'm bringing my fursuit"}),e(m,{variant:"h6",color:"inherit",children:"Early/Late Arrival"}),o(m,{variant:"body1",color:"inherit",children:["You can see how early/late arrival will affect your ticket price on the pricing page of our website"," ",e(M,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),e(X,{control:e(Z,{name:"is_early",checked:t.userInfo.is_early,onChange:s}),label:"I want to arrive a day early (Arrive on the afternoon of the 10th November)"}),e(X,{control:e(Z,{name:"is_late",checked:t.userInfo.is_late,onChange:s}),label:"I want to leave a day late (Leave on the morning of the 15th November)"}),e(m,{variant:"h6",color:"inherit",children:"Sponsor"}),o(m,{variant:"body1",color:"inherit",children:["You can choose to help support the convention further by becoming one of our sponsors. Sponsoring costs \xA340 and sponsors get a goodybag on arrival. You can read more about sponsoring on our pricing page"," ",e(M,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),e(X,{control:e(Z,{name:"is_sponsor",checked:t.userInfo.is_sponsor,onChange:s}),label:"I want to sponsor"})]})]})}function Lt(){return o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Legal"}),o(m,{variant:"body1",color:"inherit",children:[e(Z,{required:!0,name:"t_and_cs"}),"Do you agree to the"," ",e(M,{href:"https://www.furcation.org.uk/docs/privacypolicy.pdf",target:"_blank",children:"privacy policy"})," ","and the"," ",e(M,{href:"https://www.furcation.org.uk/docs/codeofconduct.pdf",target:"_blank",children:"code of conduct"}),"?"]})]})}function Nt(){const t=F(),[n,r]=c.exports.useState(new At),[a,i]=c.exports.useState(!1),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState({}),[b,y]=c.exports.useState(""),x=B(f=>f.user.authed);c.exports.useEffect(()=>{x&&t(S("/manage"))},[]);const k=f=>{r(J(O({},n),{[f.target.name]:f.target.value}))},D=f=>{r(O(O({},n),f))},h=f=>{r(O(O({},n),f))},E=()=>{t(S("/login"))},d=f=>{const G=Date.parse("11 November 2004");if(f.preventDefault(),i(!0),n.email!==n.confirm_email){p({email:"Email and confirm email did not match."});return}if(n.password!==n.confirm_password){p({password:"Password and confirm password did not match."});return}if(Date.parse(n.date_of_birth)>=G){p({date_of_birth:"You must be 18 years old by November 11th 2022."});return}n.phone_number=w(n.phone_number),n.ice_phone=w(n.ice_phone),console.log(n),window.grecaptcha.enterprise.ready(function(){window.grecaptcha.enterprise.execute("6LeVPFEhAAAAAGC1Sc6mImon0DWwloJD3c_nyRU2",{action:"register"}).then(function($){console.log("ReCAPTCHA token: "+$),pt(n,$).then(z=>{z.status==201?z.json().then(C=>{y(C.email),l(!0)}):z.json().then(C=>{p(C)})})})})},p=f=>{g(f),i(!1),window.scrollTo(0,0)},w=f=>(f=f.replaceAll(" ",""),f.charAt(0)==="0"?"+44"+f.substring(1):f);return o(I,{component:"form",onSubmit:d,spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(u).length>0?e(q,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,o(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:[e(m,{variant:"h6",color:"inherit",children:"New Registration"}),o(R,{container:!0,spacing:2,sx:{mt:2},children:[e(R,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:a,type:"email",autoComplete:"email",name:"email",value:n.email,onChange:k,label:"Email Address",error:Object.prototype.hasOwnProperty.call(u,"email"),helperText:u.email})}),e(R,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"email",name:"confirm_email",onChange:k,value:n.confirm_email,label:"Confirm Email",error:Object.prototype.hasOwnProperty.call(u,"confirm_email"),helperText:u.confirm_email})}),e(R,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"password",name:"password",onChange:k,value:n.password,label:"Password",error:Object.prototype.hasOwnProperty.call(u,"password"),helperText:u.password})}),e(R,{item:!0,xs:12,sm:6,children:e(_,{required:!0,fullWidth:!0,disabled:a,type:"password",name:"confirm_password",onChange:k,value:n.confirm_password,label:"Confirm Password",error:Object.prototype.hasOwnProperty.call(u,"confirm_password"),helperText:u.confirm_password})})]})]}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(be,{userInfo:n,onChange:h,disabled:a,errors:u,isSignup:!0})}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(pe,{emergencyContact:n,onChange:D,disabled:a,errors:u})}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Lt,{})}),e(j,{loading:a,loadingPosition:"center",type:"submit",variant:"contained",children:"Next"}),o(Q,{open:s,onClose:E,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ee,{id:"alert-dialog-title",children:"You're almost done!"}),e(te,{children:o(ae,{id:"alert-dialog-description",children:["An email has been sent to ",b,". Please click the link in there to verify your account."]})}),e(ne,{children:e(N,{onClick:E,autoFocus:!0,children:"Log In"})})]})]})}function Gt(t){const n=F(),[r,a]=c.exports.useState(null),[i,s]=c.exports.useState(""),[l,u]=c.exports.useState(""),[g,b]=c.exports.useState(!1);c.exports.useEffect(()=>{y()},[]);const y=()=>{xt().then(d=>{b(!1),d.status==200?d.json().then(p=>{a(p)}):d.status==404?a(null):d.status==401&&(n(S("/")),n(ie()),localStorage.removeItem("TOKEN"))})},x=d=>{s(d.target.value.trim())},k=d=>{d.preventDefault(),b(!0),St(i).then(p=>{p.status==200?(u(""),y()):(b(!1),p.json().then(w=>u(w.details)))})},D=()=>{b(!0),Ct().then(d=>{d.status==201?(u(""),y()):(b(!1),d.json().then(p=>u(p.details)))})},h=()=>{r&&navigator.clipboard.writeText(r.id)},E=()=>{b(!0),_t().then(d=>{d.status==200?(u(""),y()):(b(!1),d.json().then(p=>u(p.details)))})};return o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Accommodation Group"}),o(m,{variant:"body1",color:"inherit",children:["Furcation has a variety of units available to suit various budgets and group sizes. You can read more about accommodation pricing and the features of each type of unit"," ",e(M,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),". During pre-reg you cannot select an accommodation, but you can choose who you wish to group with."]}),l?e(q,{severity:"error",children:l}):null,r?o(V,{children:[o(m,{variant:"body1",color:"inherit",children:[r.owner.nickname,"'s group",e(N,{onClick:E,sx:{ml:2},type:"submit",disabled:g,variant:"contained",color:"error",children:t.user.id==r.owner.id?"Disband Group":"Leave Group"})]}),o(m,{variant:"body1",color:"inherit",children:["Group code: ",r.id,e(He,{title:"Copy",children:e(he,{"aria-label":"copy",onClick:h,children:e(We,{})})})]}),e(Me,{dense:!0,children:r.users.map((d,p)=>e(qe,{children:e(ze,{primary:d.id==r.owner.id?d.nickname+" (host)":d.nickname})},p))})]}):o(V,{children:[e(m,{variant:"body1",color:"inherit",children:"Create a new group, or join someone else's group by entering their group code!"}),o(R,{component:"form",onSubmit:k,container:!0,spacing:2,sx:{mt:2,pr:2},children:[e(R,{item:!0,sm:12,md:5,children:e(_,{size:"small",disabled:g,fullWidth:!0,required:!0,id:"outlined-basic",label:"Group Code",variant:"outlined",value:i,onChange:x})}),e(R,{item:!0,sm:12,md:3,alignItems:"stretch",style:{display:"flex"},children:e(N,{fullWidth:!0,type:"submit",disabled:g,variant:"contained",children:"Join Group"})}),e(R,{item:!0,sm:12,md:4,alignItems:"stretch",style:{display:"flex"},children:e(N,{fullWidth:!0,variant:"outlined",disabled:g,onClick:D,children:"Create New Group"})})]})]})]})}const Rt=Ke("input")({display:"none"});function jt(t){const[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(!1),[u,g]=c.exports.useState({x:0,y:0}),[b,y]=c.exports.useState(1),[x,k]=c.exports.useState({width:100,height:100,x:0,y:0}),[D,h]=c.exports.useState(500);c.exports.useEffect(()=>{h(Math.min(500,window.screen.width-64))},[]);const E=async C=>{if(C.target.files&&C.target.files.length>0){l(!0);const P=C.target.files[0];d(P).then(L=>{g({x:0,y:0}),y(1),l(!1),i(L)})}},d=C=>new Promise(P=>{const L=new FileReader;L.addEventListener("load",()=>P(L.result),!1),L.readAsDataURL(C)}),p=()=>{i("")},w=(C,P)=>{k(P)},f=()=>{l(!0),G(a,x).then(C=>{It().then(P=>{P.status==201&&P.json().then(L=>{Pt(L.upload_url,C).then(()=>{t.badgeImageChanged(L.badge_image),l(!1),p()})})})})},G=async(C,P)=>{const Y=await $(C),U=document.createElement("canvas"),H=U.getContext("2d");if(!H)return null;U.width=Math.max(Y.width,300),U.height=Math.max(Y.height,300),H.imageSmoothingEnabled=!0,H.scale(300/P.width,300/P.height),H.drawImage(Y,-P.x,-P.y);const ye=H.getImageData(0,0,300,300);return U.width=300,U.height=300,H.putImageData(ye,0,0),new Promise(we=>{U.toBlob(ve=>{we(ve)},"image/jpeg")})},$=C=>new Promise((P,L)=>{const K=new Image;K.addEventListener("load",()=>P(K)),K.addEventListener("error",Y=>L(Y)),K.src=C}),z=()=>{l(!0),Et().then(C=>{C.status==200&&(l(!1),t.badgeImageChanged(""))})};return o(V,{children:[o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Badge Image"}),t.user.badge_image?o(I,{direction:"row",children:[e("img",{style:{width:"150px",marginRight:"8px"},src:"https://storage.googleapis.com/reggie-badges/"+t.user.badge_image}),e(oe,{alignItems:"center",display:"flex",justifyContent:"center",children:e(j,{loading:s,loadingPosition:"center",variant:"contained",color:"error",onClick:z,children:"Delete Badge Image"})})]}):o("label",{htmlFor:"contained-button-file",children:[e(Rt,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:E}),e(j,{loading:s,loadingPosition:"center",variant:"contained",component:"span",children:"Upload Badge Image"})]})]}),o(Q,{open:!!a,onClose:p,children:[o(ee,{children:["Crop Badge Image",e(m,{children:"Scroll or pinch to zoom. Click and drag to move."})]}),e(te,{style:{position:"relative",width:D+"px",height:D+"px"},children:e(Ye,{image:a,crop:u,zoom:b,aspect:1,onCropChange:g,onZoomChange:y,onCropComplete:w})}),e(ne,{children:e(j,{loading:s,loadingPosition:"center",onClick:f,autoFocus:!0,children:"Upload"})})]})]})}function Bt(){const t=F(),[n,r]=c.exports.useState(null),[a,i]=c.exports.useState({}),[s,l]=c.exports.useState(0),u=B(h=>h.user.authed);c.exports.useEffect(()=>{if(!u){t(S("/"));return}wt().then(h=>{h.status==200?h.json().then(E=>{r(Object.assign(new Dt,E))}):h.status==401&&(t(S("/")),t(ie()),localStorage.removeItem("TOKEN"))})},[]);const g=h=>{h.preventDefault(),l(1),n&&(n.phone_number=y(n.phone_number),n.ice_phone=y(n.ice_phone),vt(n).then(E=>{E.status==200?l(2):E.json().then(d=>{b(d),console.log(d)})}))},b=h=>{i(h),l(0),window.scrollTo(0,0)},y=h=>(h=h.replaceAll(" ",""),h.charAt(0)==="0"?"+44"+h.substring(1):h),x=h=>{n&&(l(0),r(O(O({},n),h)))},k=h=>{n&&(l(0),r(O(O({},n),h)))},D=h=>{n&&r(J(O({},n),{badge_image:h}))};return o(I,{spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(a).length>0?e(q,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,n?o(V,{children:[o(I,{component:"form",onSubmit:g,spacing:2,children:[e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Your Attendee Infomation"}),o(m,{variant:"body1",color:"inherit",children:["Email: ",n.email]}),o(m,{variant:"body1",color:"inherit",children:["Badge Number:"," ",n.badge_override?n.badge_override:n.id]})]})}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(be,{userInfo:n,onChange:k,disabled:s==1,errors:a,isSignup:!1})}),e(j,{loading:s==1,loadingPosition:"center",type:"submit",variant:"contained",color:s==2?"success":"primary",children:s==2?"Saved!":"Save Changes"}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(pe,{emergencyContact:n,onChange:x,disabled:s==1,errors:a})}),e(j,{loading:s==1,loadingPosition:"center",type:"submit",variant:"contained",color:s==2?"success":"primary",children:s==2?"Saved!":"Save Changes"})]}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Gt,{user:n})}),e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(jt,{user:n,badgeImageChanged:D})})]}):null]})}function Ft(){const t=F(),{uid:n,token:r}=Je(),[a,i]=c.exports.useState(""),[s,l]=c.exports.useState(""),[u,g]=c.exports.useState(""),[b,y]=c.exports.useState(!1),[x,k]=c.exports.useState(!1),D=B(w=>w.user.authed);c.exports.useEffect(()=>{D&&t(S("/manage")),(!n||!r)&&t(S("/"))},[]);const h=w=>{if(w.preventDefault(),y(!0),!n||!r){g("Invalid token"),y(!1);return}if(a!=s){g("Passwords do not match"),y(!1);return}yt(a,n,r).then(f=>{f.status==204?k(!0):f.json().then(G=>{console.log(G),g(G.token||G.new_password),y(!1)})})},E=w=>{i(w.target.value)},d=w=>{l(w.target.value)},p=()=>{t(S("/login"))};return o(I,{component:"form",onSubmit:h,spacing:2,sx:{my:{xs:3,md:3}},children:[u?e(q,{severity:"error",children:u}):null,e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"New Password"}),e(_,{required:!0,fullWidth:!0,disabled:b,type:"password",name:"password",onChange:E,value:a,label:"Password"}),e(_,{required:!0,fullWidth:!0,disabled:b,type:"password",name:"confirm_password",onChange:d,value:s,label:"Confirm Password"})]})}),e(j,{loading:b,loadingPosition:"center",type:"submit",variant:"contained",children:"Change Password"}),o(Q,{open:x,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ee,{id:"alert-dialog-title",children:"Password Changed"}),e(te,{children:e(ae,{id:"alert-dialog-description",children:"Your password has been changed! You can now log in."})}),e(ne,{children:e(N,{onClick:p,autoFocus:!0,children:"Log In"})})]})]})}function Ut(){const t=F(),[n,r]=c.exports.useState(""),[a,i]=c.exports.useState(!1),[s,l]=c.exports.useState(!1),u=B(x=>x.user.authed);c.exports.useEffect(()=>{u&&t(S("/manage"))},[]);const g=x=>{x.preventDefault(),i(!0),bt(n).then(()=>{i(!1),l(!0)})},b=x=>{r(x.target.value)},y=()=>{t(S("/login"))};return o(I,{component:"form",onSubmit:g,spacing:2,sx:{my:{xs:3,md:3}},children:[e(A,{variant:"outlined",sx:{p:{xs:2,md:3}},children:o(I,{spacing:2,children:[e(m,{variant:"h6",color:"inherit",children:"Forgot Password"}),e(_,{required:!0,fullWidth:!0,autoFocus:!0,disabled:a,type:"email",autoComplete:"email",name:"email",value:n,onChange:b,label:"Email Address"})]})}),e(j,{loading:a,loadingPosition:"center",type:"submit",variant:"contained",children:"Send recovery email"}),o(Q,{open:s,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ee,{id:"alert-dialog-title",children:"Email sent"}),e(te,{children:o(ae,{id:"alert-dialog-description",children:["If an account exists for ",n,", then an email has been sent."]})}),e(ne,{children:e(N,{onClick:y,autoFocus:!0,children:"Log In"})})]})]})}Ze.render(e(Ve.StrictMode,{children:e($e,{store:se,children:e(it,{children:e(Xe,{history:mt,children:o(Qe,{children:[e(W,{path:"/",element:e(gt,{})}),e(W,{path:"/login",element:e(Ot,{})}),e(W,{path:"/recover",element:e(Ut,{})}),e(W,{path:"/recover/confirm/:uid/:token",element:e(Ft,{})}),e(W,{path:"/newregistration",element:e(Nt,{})}),e(W,{path:"/manage",element:e(Bt,{})})]})})})})}),document.getElementById("root"));Tt().then(t=>{t.status==200&&t.json().then(n=>{const r={};n.results.map(a=>{r[a.id]=a.value}),se.dispatch(lt(r))})});
