var Ee=Object.defineProperty,Ae=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var be=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var he=(t,n,o)=>n in t?Ee(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,j=(t,n)=>{for(var o in n||(n={}))De.call(n,o)&&he(t,o,n[o]);if(be)for(var o of be(n))Ne.call(n,o)&&he(t,o,n[o]);return t},X=(t,n)=>Ae(t,Oe(n));var E=(t,n,o)=>(he(t,typeof n!="symbol"?n+"":n,o),o);import{u as Le,a as Re,c as xe,b as Ge,r as l,j as a,T as je,d as e,C as Fe,A as Be,e as we,f as We,g as f,L as Q,B as se,I as ve,h as Me,M as Ue,i as me,k as F,p as R,l as ze,m as He,n as Ye,P as M,S as D,o as z,q as A,s as J,t as qe,D as Ke,v as Je,F as Y,w as le,x as ie,G as O,y as ee,z as re,E as te,H as oe,J as ae,R as Ce,K as Xe,N as Ze,O as ge,Q as q,U as K,V as ce,W as Ve,X as $e,Y as Qe,Z as et,_ as tt,$ as nt,a0 as ot,a1 as rt,a2 as at,a3 as it,a4 as ne}from"./vendor.594eba22.js";const st=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=o(s);fetch(s.href,c)}};st();const Z=()=>Le(),U=Re,lt={authed:!!localStorage.getItem("TOKEN")},_e=xe({name:"user",initialState:lt,reducers:{login(t){t.authed=!0},logout(t){t.authed=!1}}}),{login:ct,logout:de}=_e.actions;var dt=_e.reducer;const ut=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,ht=Ge({palette:{mode:ut?"dark":"light"}});function mt(t){const n=Z(),o=U(m=>m.user.authed),[r,s]=l.exports.useState(null),c=m=>{s(m.currentTarget)},i=()=>{s(null)},d=()=>{s(null),n(R("/")),n(de()),localStorage.removeItem("TOKEN")};return a(je,{theme:ht,children:[e(Fe,{}),e(Be,{position:"absolute",color:"default",elevation:0,sx:{position:"relative",borderBottom:m=>`1px solid ${m.palette.divider}`},children:e(we,{maxWidth:"xl",children:a(We,{disableGutters:!0,children:[e(f,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,mr:2,display:{xs:"none",md:"flex"}},children:e(Q,{color:"inherit",underline:"none",href:"/",children:"Furcation Registration"})}),a(se,{sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:[e(ve,{size:"large","aria-label":"account of current user","aria-controls":"menu-appbar","aria-haspopup":"true",onClick:c,color:"inherit",children:e(Me,{})}),a(Ue,{id:"menu-appbar",anchorEl:r,anchorOrigin:{vertical:"bottom",horizontal:"left"},keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"left"},open:Boolean(r),onClose:i,sx:{display:{xs:"block",md:"none"}},children:[o?e(me,{onClick:d,children:e(f,{textAlign:"center",children:"Logout"})}):null,e(me,{onClick:i,children:e("a",{href:"//furcation.org.uk",children:e(f,{textAlign:"center",children:"Return to main site"})})})]})]}),e(f,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:{xs:"flex",md:"none"}},children:"Furcation Registration"}),a(se,{sx:{display:{xs:"none",md:"flex"}},children:[o?e(F,{onClick:d,sx:{my:2,display:"block"},children:"Logout"}):null,e(F,{onClick:i,sx:{my:2,display:"block"},href:"//furcation.org.uk",children:"Return to main site"})]})]})})}),e(we,{component:"main",children:t.children})]})}const gt={config:{}},Se=xe({name:"config",initialState:gt,reducers:{setConfig(t,n){t.config=n.payload}}}),{setConfig:ft}=Se.actions;var pt=Se.reducer;const{createReduxHistory:yt,routerMiddleware:bt,routerReducer:wt}=ze({history:He()}),fe=Ye({reducer:{router:wt,user:dt,config:pt},middleware:[bt]}),xt=yt(fe);function vt(){const t=Z(),n=U(r=>r.config.config.INTRO_TEXT||""),o=U(r=>r.user.authed);return l.exports.useEffect(()=>{o&&t(R("/manage"))},[]),a(M,{variant:"outlined",sx:{my:{xs:3,md:6},p:{xs:2,md:3}},children:[e(f,{variant:"h6",color:"inherit",children:"Welcome to Furcation 2022 Registation"}),n.split(`
`).map((r,s)=>e(f,{variant:"body1",color:"inherit",paragraph:!0,children:r},s)),a(D,{spacing:2,alignItems:"center",children:[e(F,{variant:"contained",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(R("/newregistration")),children:"Register for Furcation"}),e(F,{variant:"outlined",sx:{minWidth:{sm:400,xs:"100%"}},onClick:()=>t(R("/login")),children:"Already registered? Log in"})]})]})}const G=window.location.hostname=="localhost"?"http://localhost:8000/":"https://api.reg.furcation.org.uk/";function Ct(t,n){return fetch(G+"auth/users/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(X(j({},t),{recaptcha_token:n}))})}function _t(t,n){return fetch(G+"auth/token/login/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t,password:n})})}function St(t,n){return fetch(G+"auth/users/set_password/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN"),"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({new_password:t,current_password:n})})}function Pt(t){return fetch(G+"auth/users/reset_password/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({email:t})})}function It(t,n,o){return fetch(G+"auth/users/reset_password_confirm/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({new_password:t,uid:n,token:o})})}function Tt(){return fetch(G+"auth/users/me/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function pe(t){return fetch(G+"auth/users/me/",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify(t)})}function ye(){return fetch(G+"group/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function kt(){return fetch(G+"group/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Et(){return fetch(G+"group/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function At(t){return fetch(G+"group/",{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json",Authorization:"Token "+localStorage.getItem("TOKEN")},body:JSON.stringify({id:t})})}function Ot(){return fetch(G+"badge-image/",{method:"POST",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Dt(t,n){return fetch(t,{method:"PUT",headers:{"Content-Type":"application/octet-stream"},body:n})}function Nt(){return fetch(G+"badge-image/",{method:"DELETE",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Lt(){return fetch(G+"config/",{method:"GET"})}function Rt(t,n){return fetch(G+"auth/users/activation/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:t,token:n})})}function Gt(){return fetch(G+"accommodation/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function jt(){return fetch(G+"payment/",{method:"GET",credentials:"include",headers:{Authorization:"Token "+localStorage.getItem("TOKEN")}})}function Ft(t){return fetch(G+"group-accommodation/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Token "+localStorage.getItem("TOKEN")},body:new URLSearchParams({id:t})})}function Bt(){const t=Z(),[n,o]=l.exports.useState(""),[r,s]=l.exports.useState(""),[c,i]=l.exports.useState(!1),[d,m]=l.exports.useState(""),[C,w]=l.exports.useState(""),b=U(x=>x.user.authed);return l.exports.useEffect(()=>{b&&t(R("/manage"));const x=new URLSearchParams(window.location.search),v=x.get("uid"),p=x.get("token");!b&&v&&p&&Rt(v,p).then(y=>{y.status==204||y.status==403?w("Email verified!  You can now login below."):(m("Error while validating email."),y.json().then(L=>console.log(L)))})},[]),a(D,{component:"form",onSubmit:x=>{x.preventDefault(),i(!0),_t(n,r).then(v=>{v.status==200?v.json().then(p=>{localStorage.setItem("TOKEN",p.auth_token),t(ct()),t(R("/manage"))}):v.json().then(p=>{console.log(p),m(p.non_field_errors),i(!1)})})},spacing:2,sx:{my:{xs:3,md:3}},children:[d?e(z,{severity:"error",children:d}):null,C?e(z,{severity:"success",children:C}):null,e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Sign in"}),e(A,{required:!0,fullWidth:!0,autoFocus:!0,disabled:c,type:"email",autoComplete:"email",name:"email",value:n,onChange:x=>{o(x.target.value)},label:"Email Address"}),e(A,{required:!0,fullWidth:!0,disabled:c,type:"password",name:"password",onChange:x=>{s(x.target.value)},value:r,label:"Password"}),e(J,{loading:c,loadingPosition:"center",type:"submit",variant:"contained",children:"Login"}),e(F,{variant:"outlined",onClick:()=>{t(R("/recover"))},children:"Forgot password?"})]})})]})}function Pe(t){const n=o=>{t.emergencyContact[o.target.name]=o.target.value,t.onChange(t.emergencyContact)};return a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Emergency Contacts"}),e(f,{variant:"body1",color:"inherit",children:"Please provide a contact we can call in case of emergency"}),e(A,{required:!0,disabled:t.disabled,name:"ice_name",label:"Emergency Contact Name",value:t.emergencyContact.ice_name,onChange:n,autoComplete:"phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_name"),helperText:t.errors.ice_name}),e(A,{required:!0,disabled:t.disabled,type:"tel",name:"ice_phone",label:"Emergency Phone Number",value:t.emergencyContact.ice_phone,onChange:n,autoComplete:"ice_phone",error:Object.prototype.hasOwnProperty.call(t.errors,"ice_phone"),helperText:t.errors.ice_phone})]})}class Ie{constructor(){E(this,"email","");E(this,"full_name","");E(this,"nickname","");E(this,"date_of_birth","1990-01-01");E(this,"address","");E(this,"phone_number","");E(this,"medical_details","");E(this,"ice_name","");E(this,"ice_phone","");E(this,"is_sponsor",!1);E(this,"is_early",!1);E(this,"is_late",!1);E(this,"is_fursuiter",!1)}}class Wt extends Ie{constructor(){super(...arguments);E(this,"confirm_email","");E(this,"password","");E(this,"confirm_password","")}}class Mt extends Ie{constructor(){super(...arguments);E(this,"id",0);E(this,"badge_override","");E(this,"badge_image","");E(this,"paid",0);E(this,"adjustments",0)}}function Te(t){const[n,o]=l.exports.useState(t.userInfo.date_of_birth),r=i=>{const d=new Date(i),m=d.getFullYear()+"-"+("0"+(d.getMonth()+1)).slice(-2)+"-"+("0"+d.getDate()).slice(-2);o(m),t.userInfo.date_of_birth=m,t.onChange(t.userInfo)},s=i=>{t.userInfo[i.target.name]=i.target.value,t.onChange(t.userInfo)},c=i=>{t.userInfo[i.target.name]=i.target.checked,t.onChange(t.userInfo)};return a(D,{spacing:2,children:[e(A,{required:!0,disabled:t.disabled,name:"full_name",label:"Full (Legal) Name",value:t.userInfo.full_name,onChange:s,autoComplete:"fullname",error:Object.prototype.hasOwnProperty.call(t.errors,"full_name"),helperText:t.errors.full_name}),e(A,{required:!0,disabled:t.disabled,name:"nickname",label:"Furry Name (Nickname/Badge Name)",value:t.userInfo.nickname,onChange:s,autoComplete:"nickname",error:Object.prototype.hasOwnProperty.call(t.errors,"nickname"),helperText:t.errors.nickname}),e(qe,{dateAdapter:Ke,children:e(Je,{label:"Date of Birth (yyyy-mm-dd)",disabled:t.disabled,value:n,onChange:r,inputFormat:"yyyy-MM-dd",mask:"____-__-__",renderInput:i=>e(A,X(j({name:"date_of_birth"},i),{required:!0,error:Object.prototype.hasOwnProperty.call(t.errors,"date_of_birth"),helperText:t.errors.date_of_birth}))})}),e(A,{required:!0,multiline:!0,disabled:t.disabled,rows:4,name:"address",label:"Address",value:t.userInfo.address,onChange:s,error:Object.prototype.hasOwnProperty.call(t.errors,"address"),helperText:t.errors.address}),e(A,{required:!0,disabled:t.disabled,type:"tel",name:"phone_number",label:"Phone Number",autoComplete:"phone",value:t.userInfo.phone_number,onChange:s,error:Object.prototype.hasOwnProperty.call(t.errors,"phone_number"),helperText:t.errors.phone_number}),e(A,{multiline:!0,disabled:t.disabled,rows:4,name:"medical_details",label:"Any medical details we should know? (optional)",value:t.userInfo.medical_details||"",onChange:s,error:Object.prototype.hasOwnProperty.call(t.errors,"medical_details"),helperText:t.errors.medical_details}),t.isSignup?null:a(Y,{children:[e(f,{variant:"h6",color:"inherit",children:"Fursuiting"}),e(f,{variant:"body1",color:"inherit",children:"You don't need a fursuit to attend Furcation, but to help us plan for fursuiting events, please let us know if you're bringing your fursuit."}),e(le,{control:e(ie,{name:"is_fursuiter",checked:t.userInfo.is_fursuiter,onChange:c}),label:"I'm bringing my fursuit"}),e(f,{variant:"h6",color:"inherit",children:"Early/Late Arrival"}),a(f,{variant:"body1",color:"inherit",children:["You can see how early/late arrival will affect your ticket price on the pricing page of our website"," ",e(Q,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),t.group&&t.group.accommodation?e(f,{variant:"body1",color:"inherit",children:"Your group has an accommodation selected and is awaiting payment, so your early/late choices cannot be changed."}):null,e(le,{control:e(ie,{name:"is_early",checked:t.userInfo.is_early,disabled:!!(t.group&&t.group.accommodation),onChange:c}),label:"I want to arrive a day early (Arrive on the afternoon of the 10th November)"}),e(le,{control:e(ie,{name:"is_late",checked:t.userInfo.is_late,disabled:!!(t.group&&t.group.accommodation),onChange:c}),label:"I want to leave a day late (Leave on the morning of the 15th November)"}),e(f,{variant:"h6",color:"inherit",children:"Sponsor"}),a(f,{variant:"body1",color:"inherit",children:["You can choose to help support the convention further by becoming one of our sponsors. Sponsoring costs \xA340 and sponsors get a goodybag on arrival. You can read more about sponsoring on our pricing page"," ",e(Q,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),t.userInfo.paid?e(f,{variant:"body1",color:"inherit",children:"Once you have paid, you cannot change your sponsor settings."}):null,e(le,{control:e(ie,{name:"is_sponsor",disabled:!!t.userInfo.paid,checked:t.userInfo.is_sponsor,onChange:c}),label:"I want to sponsor"})]})]})}function Ut(){return a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Legal"}),a(f,{variant:"body1",color:"inherit",children:[e(ie,{required:!0,name:"t_and_cs"}),"Do you agree to the"," ",e(Q,{href:"https://www.furcation.org.uk/docs/furcation-privacy-policy-1.2.pdf",target:"_blank",children:"privacy policy"})," ","and the"," ",e(Q,{href:"https://www.furcation.org.uk/docs/furcation-code-of-conduct.2022.03.pdf",target:"_blank",children:"code of conduct"}),"?"]})]})}function zt(){const t=Z(),[n,o]=l.exports.useState(new Wt),[r,s]=l.exports.useState(!1),[c,i]=l.exports.useState(!1),[d,m]=l.exports.useState({}),[C,w]=l.exports.useState(""),b=U(y=>y.user.authed);l.exports.useEffect(()=>{b&&t(R("/manage"))},[]);const P=y=>{o(X(j({},n),{[y.target.name]:y.target.value}))},I=y=>{o(j(j({},n),y))},B=y=>{o(j(j({},n),y))},S=()=>{t(R("/login"))},x=y=>{const L=Date.parse("11 November 2004");if(y.preventDefault(),s(!0),n.email!==n.confirm_email){v({email:"Email and confirm email did not match."});return}if(n.password!==n.confirm_password){v({password:"Password and confirm password did not match."});return}if(Date.parse(n.date_of_birth)>=L){v({date_of_birth:"You must be 18 years old by November 11th 2022."});return}n.phone_number=p(n.phone_number),n.ice_phone=p(n.ice_phone),console.log(n),window.grecaptcha.enterprise.ready(function(){window.grecaptcha.enterprise.execute("6LeVPFEhAAAAAGC1Sc6mImon0DWwloJD3c_nyRU2",{action:"register"}).then(function(g){console.log("ReCAPTCHA token: "+g),Ct(n,g).then(N=>{N.status==201?N.json().then(_=>{w(_.email),i(!0)}):N.json().then(_=>{v(_)})})})})},v=y=>{m(y),s(!1),window.scrollTo(0,0)},p=y=>(y=y.replaceAll(" ",""),y.charAt(0)==="0"?"+44"+y.substring(1):y);return a(D,{component:"form",onSubmit:x,spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(d).length>0?e(z,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,a(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:[e(f,{variant:"h6",color:"inherit",children:"New Registration"}),a(O,{container:!0,spacing:2,sx:{mt:2},children:[e(O,{item:!0,xs:12,sm:6,children:e(A,{required:!0,fullWidth:!0,autoFocus:!0,disabled:r,type:"email",autoComplete:"email",name:"email",value:n.email,onChange:P,label:"Email Address",error:Object.prototype.hasOwnProperty.call(d,"email"),helperText:d.email})}),e(O,{item:!0,xs:12,sm:6,children:e(A,{required:!0,fullWidth:!0,disabled:r,type:"email",name:"confirm_email",onChange:P,value:n.confirm_email,label:"Confirm Email",error:Object.prototype.hasOwnProperty.call(d,"confirm_email"),helperText:d.confirm_email})}),e(O,{item:!0,xs:12,sm:6,children:e(A,{required:!0,fullWidth:!0,disabled:r,type:"password",name:"password",onChange:P,value:n.password,label:"Password",error:Object.prototype.hasOwnProperty.call(d,"password"),helperText:d.password})}),e(O,{item:!0,xs:12,sm:6,children:e(A,{required:!0,fullWidth:!0,disabled:r,type:"password",name:"confirm_password",onChange:P,value:n.confirm_password,label:"Confirm Password",error:Object.prototype.hasOwnProperty.call(d,"confirm_password"),helperText:d.confirm_password})})]})]}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Te,{userInfo:n,group:null,onChange:B,disabled:r,errors:d,isSignup:!0})}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Pe,{emergencyContact:n,onChange:I,disabled:r,errors:d})}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Ut,{})}),e(J,{loading:r,loadingPosition:"center",type:"submit",variant:"contained",children:"Next"}),a(ee,{open:c,onClose:S,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(re,{id:"alert-dialog-title",children:"You're almost done!"}),e(te,{children:a(oe,{id:"alert-dialog-description",children:["An email has been sent to ",C,". Please click the link in there to verify your account."]})}),e(ae,{children:e(F,{onClick:S,autoFocus:!0,children:"Log In"})})]})]})}function Ht(t){const[n,o]=l.exports.useState(""),[r,s]=l.exports.useState(""),c=()=>{pe(t.user).then(()=>{Ft(t.type).then(m=>{m.status==200?(o(""),t.handleClose(!0)):m.json().then(C=>{o(C.details),t.reloadAccommodations()})})})},i=()=>{t.handleClose(!1),o("")},d=m=>{s(m.target.value)};return a(ee,{open:t.open,onClose:()=>t.handleClose(!1),scroll:"body",children:[e(re,{color:"error.main",children:"IMPORTANT - READ THIS FIRST"}),a(te,{children:[e(z,{severity:"warning",children:e(f,{children:"WARNING: This action cannot be undone!"})}),n?e(z,{severity:"error",variant:"outlined",children:n}):null,a(oe,{children:["Once you select your accommodation, nobody can leave or join your group. Make sure you have everyone in your group who you intend to share with.",e("br",{}),e("br",{}),"Also, make sure all of your group members have selected whether they are staying early/late. Once you have selected an accommodation, your group cannot change their extra days.",e("br",{}),e("br",{}),"Everyone in your group will be able to pay once you press claim.",e("br",{}),e("br",{}),"If you understand this, type ",e("strong",{children:"I AGREE"})," into the box below and press claim."]}),e(A,{margin:"dense",id:"agree",label:"Agreement",onChange:d,fullWidth:!0,variant:"outlined",value:r})]}),a(ae,{children:[e(F,{onClick:i,children:"Cancel"}),e(F,{onClick:c,variant:"contained",disabled:r.toLowerCase().trim()!="i agree",children:"Claim!"})]})]})}function Yt(t){const n=Z(),[o,r]=l.exports.useState(null),[s,c]=l.exports.useState(""),[i,d]=l.exports.useState(""),[m,C]=l.exports.useState(""),[w,b]=l.exports.useState(!1),[P,I]=Ce.useState(""),[B,S]=l.exports.useState(!1),x=U(h=>h.config.config.CLAIM_MODE||"0"),v=h=>{I(h.target.value)},p=()=>{S(!0)},y=h=>{if(h){C("Accommodation Claimed!");const k=_(P);o!=null&&k!=null&&(t.accommodationChanged(k),r(X(j({},o),{accommodation:k})))}S(!1)},[L,g]=l.exports.useState([]);l.exports.useEffect(()=>{u(),T()},[]);const N=h=>{if(o!=null&&h!=null){if(h.availability-h.occupied<=0)return"(Out of stock!)";if(o.users.length<h.min_capacity)return"(Group too small!)";if(o.users.length>h.max_capacity)return"(Group too big!)"}return""},_=h=>{for(const k of L)if(k.id==h)return k;return null},T=()=>{Gt().then(h=>{h.json().then(k=>{if(L!=null){g(k.results);return}})})},u=()=>{ye().then(h=>{b(!1),h.status==200?h.json().then(k=>{r(k),t.groupChanged(k)}):h.status==404?(r(null),t.groupChanged(null)):h.status==401&&(n(R("/")),n(de()),localStorage.removeItem("TOKEN"))})},W=h=>{c(h.target.value.trim())},H=h=>{h.preventDefault(),b(!0),At(s).then(k=>{k.status==200?(d(""),u()):(b(!1),k.json().then(ke=>d(ke.details)))})},V=()=>{b(!0),kt().then(h=>{h.status==201?(d(""),u()):(b(!1),h.json().then(k=>d(k.details)))})},$=()=>{o&&navigator.clipboard.writeText(o.id)},ue=()=>{b(!0),Et().then(h=>{h.status==200?(d(""),C(""),r(null),t.groupChanged(null)):(b(!1),h.json().then(k=>d(k.details)))})};return a(D,{spacing:2,children:[m?e(z,{severity:"success",children:m}):null,i?e(z,{severity:"error",children:i}):null,e(f,{variant:"h6",color:"inherit",children:"Accommodation Group"}),a(f,{variant:"body1",color:"inherit",children:["Furcation has a variety of units available to suit various budgets and group sizes. You can read more about accommodation pricing and the features of each type of unit"," ",e(Q,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),o?a(Y,{children:[a(f,{variant:"body1",color:"inherit",children:[o.owner.nickname,"'s group",o.accommodation?null:e(F,{onClick:ue,sx:{ml:2},type:"submit",disabled:w,variant:"contained",color:"error",children:t.user.id==o.owner.id?"Disband Group":"Leave Group"})]}),o.accommodation?null:a(f,{variant:"body1",color:"inherit",children:["Group code: ",o.id,e(Xe,{title:"Copy",children:e(ve,{"aria-label":"copy",onClick:$,children:e(Ze,{})})})]}),e(ge,{dense:!0,children:o.users.map((h,k)=>e(q,{children:e(K,{primary:a(Y,{children:[h.nickname," ",h.id==o.owner.id?e(ce,{size:"small",color:"primary",label:"Host"}):null," ",h.is_early?e(ce,{size:"small",color:"warning",label:"Early"}):null," ",h.is_late?e(ce,{size:"small",color:"secondary",label:"Late"}):null," ",o.accommodation?e(ce,{size:"small",color:h.fully_paid?"success":"error",label:h.fully_paid?"Paid":"Not paid"}):null]})})},k))}),o.accommodation==null?e(Y,{children:t.user.id==o.owner.id&&(x=="1"&&t.user.email.endsWith("furcation.org.uk")||x=="2")?a(Y,{children:[e(f,{variant:"body1",color:"inherit",children:"As the group host, you may now choose an accommodation for your group. Also, once you have chosen an accommodation, everyone in your group will be unable to change their extra days (early/late)."}),a(D,{direction:{xs:"column",sm:"row"},alignItems:"center",spacing:2,children:[a(Ve,{sx:{minWidth:{sm:"75%",xs:"100%"}},size:"small",children:[e($e,{children:"Accommodation"}),e(Qe,{value:P,label:"Accommodation",onChange:v,children:L.map(h=>e(me,{value:h.id,children:e(f,{color:N(h)?"error.main":"text.primary",children:h.name+" "+N(h)})},h.id))})]}),e(F,{fullWidth:!0,type:"submit",variant:"contained",onClick:p,disabled:!P||!!N(_(P)),children:"Claim"})]})]}):null}):a(f,{variant:"body1",color:"inherit",children:["Your group is staying in a"," ",e("strong",{children:o.accommodation.name}),"!"]})]}):a(Y,{children:[e(f,{variant:"body1",color:"inherit",children:"Create a new group, or join someone else's group by entering their group code!"}),a(O,{component:"form",onSubmit:H,container:!0,spacing:2,sx:{mt:2,pr:2},children:[e(O,{item:!0,sm:12,md:5,children:e(A,{size:"small",disabled:w,fullWidth:!0,required:!0,id:"outlined-basic",label:"Group Code",variant:"outlined",value:s,onChange:W})}),e(O,{item:!0,sm:12,md:3,alignItems:"stretch",style:{display:"flex"},children:e(F,{fullWidth:!0,type:"submit",disabled:w,variant:"contained",children:"Join Group"})}),e(O,{item:!0,sm:12,md:4,alignItems:"stretch",style:{display:"flex"},children:e(F,{fullWidth:!0,variant:"outlined",disabled:w,onClick:V,children:"Create New Group"})})]})]}),e(Ht,{user:t.user,open:B,handleClose:y,type:P,reloadAccommodations:T})]})}const qt=et("input")({display:"none"});function Kt(t){const[r,s]=l.exports.useState(""),[c,i]=l.exports.useState(!1),[d,m]=l.exports.useState({x:0,y:0}),[C,w]=l.exports.useState(1),[b,P]=l.exports.useState({width:100,height:100,x:0,y:0}),[I,B]=l.exports.useState(500);l.exports.useEffect(()=>{B(Math.min(500,window.screen.width-64))},[]);const S=async _=>{if(_.target.files&&_.target.files.length>0){i(!0);const T=_.target.files[0];x(T).then(u=>{m({x:0,y:0}),w(1),i(!1),s(u)})}},x=_=>new Promise(T=>{const u=new FileReader;u.addEventListener("load",()=>T(u.result),!1),u.readAsDataURL(_)}),v=()=>{s("")},p=(_,T)=>{P(T)},y=()=>{i(!0),L(r,b).then(_=>{Ot().then(T=>{T.status==201&&T.json().then(u=>{Dt(u.upload_url,_).then(()=>{t.badgeImageChanged(u.badge_image),i(!1),v()})})})})},L=async(_,T)=>{const H=await g(_),V=document.createElement("canvas"),$=V.getContext("2d");if(!$)return null;V.width=Math.max(H.width,300),V.height=Math.max(H.height,300),$.imageSmoothingEnabled=!0,$.scale(300/T.width,300/T.height),$.drawImage(H,-T.x,-T.y);const ue=$.getImageData(0,0,300,300);return V.width=300,V.height=300,$.putImageData(ue,0,0),new Promise(h=>{V.toBlob(k=>{h(k)},"image/jpeg")})},g=_=>new Promise((T,u)=>{const W=new Image;W.addEventListener("load",()=>T(W)),W.addEventListener("error",H=>u(H)),W.src=_}),N=()=>{i(!0),Nt().then(_=>{_.status==200&&(i(!1),t.badgeImageChanged(""))})};return a(Y,{children:[a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Badge Image"}),t.user.badge_image?a(D,{direction:"row",children:[e("img",{style:{width:"150px",marginRight:"8px"},src:"https://storage.googleapis.com/reggie-badges/"+t.user.badge_image}),e(se,{alignItems:"center",display:"flex",justifyContent:"center",children:e(J,{loading:c,loadingPosition:"center",variant:"contained",color:"error",onClick:N,children:"Delete Badge Image"})})]}):a("label",{htmlFor:"contained-button-file",children:[e(qt,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:S}),e(J,{loading:c,loadingPosition:"center",variant:"contained",component:"span",children:"Upload Badge Image"})]})]}),a(ee,{open:!!r,onClose:v,children:[a(re,{children:["Crop Badge Image",e(f,{children:"Scroll or pinch to zoom. Click and drag to move."})]}),e(te,{style:{position:"relative",width:I+"px",height:I+"px"},children:e(tt,{image:r,crop:d,zoom:C,aspect:1,onCropChange:m,onZoomChange:w,onCropComplete:p})}),e(ae,{children:e(J,{loading:c,loadingPosition:"center",onClick:y,autoFocus:!0,children:"Upload"})})]})]})}function Jt(t){const[n,o]=l.exports.useState(""),[r,s]=l.exports.useState(""),[c,i]=l.exports.useState(""),[d,m]=l.exports.useState(""),C=I=>{o(I.target.value)},w=I=>{s(I.target.value)},b=I=>{i(I.target.value)},P=I=>{if(I.preventDefault(),r==n){m("You cannot set a new password similar to your old password");return}if(r!=c){m("These passwords do not match");return}St(r,n).then(B=>{B.status==204?t.handleClose(!0):B.json().then(S=>{m(S[Object.keys(S)[0]][0]),console.log(S)})})};return e(ee,{open:t.open,onClose:()=>t.handleClose(!1),children:a(se,{component:"span",sx:{p:1},children:[e(re,{children:"Change Password"}),a(te,{children:[e(oe,{sx:{pb:2},children:d?e(z,{severity:"error",variant:"outlined",children:d}):null}),e(oe,{children:"To change your password please input your current password, and then your new password twice."}),e(A,{autoFocus:!0,margin:"dense",id:"currentpassword",label:"Current Password",type:"password",fullWidth:!0,onChange:C,variant:"standard"}),e(A,{autoFocus:!0,margin:"dense",id:"newpassword",label:"New Password",type:"password",fullWidth:!0,onChange:w,variant:"standard"}),e(A,{autoFocus:!0,margin:"dense",id:"newpasswordrepeat",label:"New Password (Again)",type:"password",fullWidth:!0,onChange:b,variant:"standard"})]}),a(ae,{children:[e(F,{onClick:()=>t.handleClose(!1),children:"Cancel"}),e(F,{onClick:P,variant:"contained",children:"Submit"})]})]})})}function Xt(t){const n=Z(),[o,r]=l.exports.useState(!1),[s,c]=l.exports.useState(!1),[i,d]=l.exports.useState(null),[m,C]=l.exports.useState(""),w=U(g=>g.config.config.STAFF_DISCOUNT||""),b=U(g=>g.config.config.SPONSOR_PRICE||""),P=JSON.parse(U(g=>g.config.config.EXTRA_DAYS||"[]")),I=JSON.parse(U(g=>g.config.config.LODGE_EXTRA_DAYS||"[]"));l.exports.useEffect(()=>{B()},[]);const B=()=>{ye().then(g=>{g.status==200?g.json().then(N=>{d(N)}):g.status==404?d(null):g.status==401&&(n(R("/")),n(de()),localStorage.removeItem("TOKEN"))})},S=g=>(g/100).toFixed(2),x=()=>i!=null?i.users.filter(g=>g.is_early).length:0,v=()=>i!=null?i.users.filter(g=>g.is_late).length:0,p=()=>{if(!i||!i.accommodation)return 0;let g=i.accommodation.prices[i.users.length-1]||0;return t.user.email.endsWith("@furcation.org.uk")&&(g-=parseInt(w)),t.user.is_early&&(g+=i.accommodation.is_lodge?I[x()-1]:P[x()-1]),t.user.is_late&&(g+=i.accommodation.is_lodge?I[v()-1]:P[v()-1]),t.user.is_sponsor&&(g+=parseInt(b)),g+=t.user.adjustments,g},y=()=>{c(!1)},L=()=>{r(!0),pe(t.user).then(()=>{jt().then(g=>{r(!1),g.status==200||g.status==201?(C(""),c(!0),g.json().then(N=>{console.log(N),window.SumUpCard.mount({checkoutId:N.checkout,amount:""+N.amount/100,currency:"GBP",locale:"en-GB",showFooter:!0,onResponse:function(_,T){console.log(_),console.log(T),_=="success"&&(c(!1),T.status=="FAILED"?C("Payment was declined by your bank"):L())}})})):g.status==204?(C(""),t.onPaid(p())):g.status==400&&g.json().then(N=>{C(N.details)})})})};return a(Y,{children:[a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Payment"}),m?e(z,{severity:"error",children:m}):null,p()-t.user.paid<=0?e(z,{severity:"success",children:"You've paid in full! See you at Furcation 2022!"}):a(f,{variant:"body1",color:"inherit",children:["The prices listed below are based on your chosen accommodation and the number of other attendees in your group. If you are doing extra days, the price for extra days is based on whether or not your accommodation is a lodge and how many other attendees in your group are doing extra days as well. You can read more about pricing on our website"," ",e(Q,{href:"https://www.furcation.org.uk/attending/pricing/",target:"_blank",children:"here"}),"."]}),i&&i.accommodation?a(Y,{children:[a(ge,{dense:!0,children:[e(q,{children:e(K,{primary:i.accommodation.name+" with "+i.users.length+" attendee(s): \xA3"+S(i.accommodation.prices[i.users.length-1]||0)})}),t.user.is_early?e(q,{children:e(K,{primary:"Extra day (early) with "+x()+" attendee(s): \xA3"+S(i.accommodation.is_lodge?I[x()-1]:P[x()-1])})}):null,t.user.is_late?e(q,{children:e(K,{primary:"Extra day (late) with "+v()+" attendee(s): \xA3"+S(i.accommodation.is_lodge?I[v()-1]:P[v()-1])})}):null,t.user.is_sponsor?e(q,{children:e(K,{primary:"Sponsor: \xA3"+S(parseInt(b))})}):null,t.user.email.endsWith("@furcation.org.uk")?e(q,{children:e(K,{primary:"Staff discount: \xA3-"+S(parseInt(w))+" (Thanks for helping out!)"})}):null,t.user.adjustments?e(q,{children:e(K,{primary:"Manual price adjustments: \xA3"+S(t.user.adjustments)})}):null,t.user.paid&&p()>t.user.paid?e(q,{children:e(K,{primary:"Already paid: \xA3-"+S(t.user.paid)})}):null,e(q,{children:e(K,{primary:e("strong",{children:"Total: \xA3"+S(p()<=t.user.paid?p():p()-t.user.paid)})})})]}),p()-t.user.paid>0?a(Y,{children:[e(J,{loading:o,variant:"contained",onClick:L,children:"Proceed to Payment"}),a(O,{container:!0,spacing:2,children:[e(O,{item:!0,xs:12,children:"Alternatively, you can pay via bank transfer using these details:"}),e(O,{item:!0,xs:6,children:"Reference:"}),a(O,{item:!0,xs:6,children:["FC22 XXX ",e("i",{children:"(where XXX is your badge number)"})]}),e(O,{item:!0,xs:6,children:"Name:"}),e(O,{item:!0,xs:6,children:"Furcation Ltd."}),e(O,{item:!0,xs:6,children:"Account number:"}),e(O,{item:!0,xs:6,children:"66647252"}),e(O,{item:!0,xs:6,children:"Sort code:"}),e(O,{item:!0,xs:6,children:"60-83-71"}),e(O,{item:!0,xs:12,children:"When you send payment by bank transfer, please email reg@furcation.org.uk with your reference and amount sent so we can verify it has been received and mark you as paid."})]})]}):null]}):null]}),e(ee,{open:s,onClose:y,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:e(te,{id:"sumup-card"})})]})}function Zt(t){const n=U(r=>r.config.config.CLAIM_MODE||"0");return e(Y,{children:a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"What to do next?"}),e(ge,{children:(()=>{const r=t.user,s=t.group,c=[];return r.badge_image||c.push("Set up your badge image down below.  If you don't, you will get a default photo on your badge!"),s?(s.accommodation&&!r.paid&&c.push('Pay for your accommodation by going to the bottom of the page and pressing "Proceed to Payment"'),n=="0"||n=="1"&&!r.email.endsWith("@furcation.org.uk")||n=="1"&&r.email.endsWith("@furcation.org.uk")&&s.owner.id!=r.id?c.push("Wait for full reg to open, then the group host can select an accommodation"):s.accommodation||(s.owner.id==r.id?c.push("Go down to the accommodation section and choose an accommodation for your group"):c.push("Wait for your group host to select a type of accommodation for your group"))):c.push("Join or create an accommodation group."),c.length==0&&c.push("You're all done!  See you at Furcation 2022!"),c})().map((r,s)=>e(q,{children:e(K,{primary:r})},s))})]})})}function Vt(){const t=Z(),[n,o]=l.exports.useState(null),[r,s]=l.exports.useState(null),[c,i]=l.exports.useState({}),[d,m]=l.exports.useState(0),[C,w]=l.exports.useState(!1),[b,P]=l.exports.useState(""),I=()=>{w(!0)},B=u=>{u&&P("Password Changed"),w(!1)},S=U(u=>u.user.authed);l.exports.useEffect(()=>{if(!S){t(R("/"));return}Tt().then(u=>{u.status==200?(u.json().then(W=>{o(Object.assign(new Mt,W))}),ye().then(W=>{W.status==200&&W.json().then(H=>{s(H)})})):u.status==401&&(t(R("/")),t(de()),localStorage.removeItem("TOKEN"))})},[]);const x=u=>{u.preventDefault(),m(1),n&&(n.phone_number=p(n.phone_number),n.ice_phone=p(n.ice_phone),pe(n).then(W=>{W.status==200?m(2):W.json().then(H=>{v(H),console.log(H)})}))},v=u=>{i(u),m(0),window.scrollTo(0,0)},p=u=>(u=u.replaceAll(" ",""),u.charAt(0)==="0"?"+44"+u.substring(1):u),y=u=>{n&&(m(0),o(j(j({},n),u)))},L=u=>{n&&(m(0),o(j(j({},n),u)))},g=u=>{n&&o(X(j({},n),{badge_image:u}))},N=u=>{n&&o(X(j({},n),{paid:u}))},_=u=>{n&&o(X(j({},n),{group:u?u.id:""}))},T=u=>{r&&s(X(j({},r),{accommodation:u}))};return a(D,{spacing:2,sx:{my:{xs:3,md:6}},children:[Object.keys(c).length>0?e(z,{severity:"error",children:"Something went wrong - Please fix the errors below."}):null,b?a(z,{severity:"success",children:[" ",b]}):null,n?a(Y,{children:[a(D,{component:"form",onSubmit:x,spacing:2,children:[e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Zt,{user:n,group:r})}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Your Attendee Infomation"}),a(f,{variant:"body1",color:"inherit",children:["Email: ",n.email]}),a(f,{variant:"body1",color:"inherit",children:["Badge Number:"," ",n.badge_override?n.badge_override:n.id]}),e(se,{children:e(F,{variant:"outlined",onClick:I,children:"Change Password"})})]})}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Te,{userInfo:n,group:r,onChange:L,disabled:d==1,errors:c,isSignup:!1})}),e(J,{loading:d==1,loadingPosition:"center",type:"submit",variant:"contained",color:d==2?"success":"primary",children:d==2?"Saved!":"Save Changes"}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Pe,{emergencyContact:n,onChange:y,disabled:d==1,errors:c})}),e(J,{loading:d==1,loadingPosition:"center",type:"submit",variant:"contained",color:d==2?"success":"primary",children:d==2?"Saved!":"Save Changes"})]}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Yt,{user:n,groupChanged:_,accommodationChanged:T})}),e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Kt,{user:n,badgeImageChanged:g})}),r&&r.accommodation?e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:e(Xt,{user:n,onPaid:N})}):null]}):null,e(Jt,{open:C,handleClose:B})]})}function $t(){const t=Z(),{uid:n,token:o}=nt(),[r,s]=l.exports.useState(""),[c,i]=l.exports.useState(""),[d,m]=l.exports.useState(""),[C,w]=l.exports.useState(!1),[b,P]=l.exports.useState(!1),I=U(p=>p.user.authed);l.exports.useEffect(()=>{I&&t(R("/manage")),(!n||!o)&&t(R("/"))},[]);const B=p=>{if(p.preventDefault(),w(!0),!n||!o){m("Invalid token"),w(!1);return}if(r!=c){m("Passwords do not match"),w(!1);return}It(r,n,o).then(y=>{y.status==204?P(!0):y.json().then(L=>{console.log(L),m(L.token||L.new_password),w(!1)})})},S=p=>{s(p.target.value)},x=p=>{i(p.target.value)},v=()=>{t(R("/login"))};return a(D,{component:"form",onSubmit:B,spacing:2,sx:{my:{xs:3,md:3}},children:[d?e(z,{severity:"error",children:d}):null,e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"New Password"}),e(A,{required:!0,fullWidth:!0,disabled:C,type:"password",name:"password",onChange:S,value:r,label:"Password"}),e(A,{required:!0,fullWidth:!0,disabled:C,type:"password",name:"confirm_password",onChange:x,value:c,label:"Confirm Password"})]})}),e(J,{loading:C,loadingPosition:"center",type:"submit",variant:"contained",children:"Change Password"}),a(ee,{open:b,onClose:v,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(re,{id:"alert-dialog-title",children:"Password Changed"}),e(te,{children:e(oe,{id:"alert-dialog-description",children:"Your password has been changed! You can now log in."})}),e(ae,{children:e(F,{onClick:v,autoFocus:!0,children:"Log In"})})]})]})}function Qt(){const t=Z(),[n,o]=l.exports.useState(""),[r,s]=l.exports.useState(!1),[c,i]=l.exports.useState(!1),d=U(b=>b.user.authed);l.exports.useEffect(()=>{d&&t(R("/manage"))},[]);const m=b=>{b.preventDefault(),s(!0),Pt(n).then(()=>{s(!1),i(!0)})},C=b=>{o(b.target.value)},w=()=>{t(R("/login"))};return a(D,{component:"form",onSubmit:m,spacing:2,sx:{my:{xs:3,md:3}},children:[e(M,{variant:"outlined",sx:{p:{xs:2,md:3}},children:a(D,{spacing:2,children:[e(f,{variant:"h6",color:"inherit",children:"Forgot Password"}),e(A,{required:!0,fullWidth:!0,autoFocus:!0,disabled:r,type:"email",autoComplete:"email",name:"email",value:n,onChange:C,label:"Email Address"})]})}),e(J,{loading:r,loadingPosition:"center",type:"submit",variant:"contained",children:"Send recovery email"}),a(ee,{open:c,onClose:w,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(re,{id:"alert-dialog-title",children:"Email sent"}),e(te,{children:a(oe,{id:"alert-dialog-description",children:["If an account exists for ",n,", then an email has been sent."]})}),e(ae,{children:e(F,{onClick:w,autoFocus:!0,children:"Log In"})})]})]})}ot.render(e(Ce.StrictMode,{children:e(rt,{store:fe,children:e(mt,{children:e(at,{history:xt,children:a(it,{children:[e(ne,{path:"/",element:e(vt,{})}),e(ne,{path:"/login",element:e(Bt,{})}),e(ne,{path:"/recover",element:e(Qt,{})}),e(ne,{path:"/recover/confirm/:uid/:token",element:e($t,{})}),e(ne,{path:"/newregistration",element:e(zt,{})}),e(ne,{path:"/manage",element:e(Vt,{})})]})})})})}),document.getElementById("root"));Lt().then(t=>{t.status==200&&t.json().then(n=>{const o={};n.results.map(r=>{o[r.id]=r.value}),fe.dispatch(ft(o))})});
